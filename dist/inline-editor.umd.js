(function(W,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("react"),require("react-hot-toast"),require("lucide-react"),require("framer-motion")):typeof define=="function"&&define.amd?define(["exports","react","react-hot-toast","lucide-react","framer-motion"],n):(W=typeof globalThis<"u"?globalThis:W||self,n(W.CryptonicInlineEditor={},W.React,W.ReactHotToast,W.LucideReact,W.FramerMotion))})(this,function(W,n,ee,oe,ae){"use strict";var Zt=Object.defineProperty;var Qt=(W,n,ee)=>n in W?Zt(W,n,{enumerable:!0,configurable:!0,writable:!0,value:ee}):W[n]=ee;var fe=(W,n,ee)=>Qt(W,typeof n!="symbol"?n+"":n,ee);var Se={exports:{}},pe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $e;function it(){if($e)return pe;$e=1;var f=n,e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function s(b,d,u){var g,m={},P=null,C=null;u!==void 0&&(P=""+u),d.key!==void 0&&(P=""+d.key),d.ref!==void 0&&(C=d.ref);for(g in d)o.call(d,g)&&!c.hasOwnProperty(g)&&(m[g]=d[g]);if(b&&b.defaultProps)for(g in d=b.defaultProps,d)m[g]===void 0&&(m[g]=d[g]);return{$$typeof:e,type:b,key:P,ref:C,props:m,_owner:l.current}}return pe.Fragment=r,pe.jsx=s,pe.jsxs=s,pe}var ge={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var De;function at(){return De||(De=1,process.env.NODE_ENV!=="production"&&function(){var f=n,e=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),b=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),m=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),C=Symbol.for("react.offscreen"),$=Symbol.iterator,V="@@iterator";function D(t){if(t===null||typeof t!="object")return null;var a=$&&t[$]||t[V];return typeof a=="function"?a:null}var z=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function x(t){{for(var a=arguments.length,p=new Array(a>1?a-1:0),T=1;T<a;T++)p[T-1]=arguments[T];N("error",t,p)}}function N(t,a,p){{var T=z.ReactDebugCurrentFrame,R=T.getStackAddendum();R!==""&&(a+="%s",p=p.concat([R]));var F=p.map(function(A){return String(A)});F.unshift("Warning: "+a),Function.prototype.apply.call(console[t],console,F)}}var I=!1,G=!1,X=!1,E=!1,y=!1,O;O=Symbol.for("react.module.reference");function v(t){return!!(typeof t=="string"||typeof t=="function"||t===o||t===c||y||t===l||t===u||t===g||E||t===C||I||G||X||typeof t=="object"&&t!==null&&(t.$$typeof===P||t.$$typeof===m||t.$$typeof===s||t.$$typeof===b||t.$$typeof===d||t.$$typeof===O||t.getModuleId!==void 0))}function w(t,a,p){var T=t.displayName;if(T)return T;var R=a.displayName||a.name||"";return R!==""?p+"("+R+")":p}function j(t){return t.displayName||"Context"}function h(t){if(t==null)return null;if(typeof t.tag=="number"&&x("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case o:return"Fragment";case r:return"Portal";case c:return"Profiler";case l:return"StrictMode";case u:return"Suspense";case g:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case b:var a=t;return j(a)+".Consumer";case s:var p=t;return j(p._context)+".Provider";case d:return w(t,t.render,"ForwardRef");case m:var T=t.displayName||null;return T!==null?T:h(t.type)||"Memo";case P:{var R=t,F=R._payload,A=R._init;try{return h(A(F))}catch{return null}}}return null}var L=Object.assign,S=0,H,M,U,q,Z,k,B;function re(){}re.__reactDisabledLog=!0;function Ve(){{if(S===0){H=console.log,M=console.info,U=console.warn,q=console.error,Z=console.group,k=console.groupCollapsed,B=console.groupEnd;var t={configurable:!0,enumerable:!0,value:re,writable:!0};Object.defineProperties(console,{info:t,log:t,warn:t,error:t,group:t,groupCollapsed:t,groupEnd:t})}S++}}function Tt(){{if(S--,S===0){var t={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:L({},t,{value:H}),info:L({},t,{value:M}),warn:L({},t,{value:U}),error:L({},t,{value:q}),group:L({},t,{value:Z}),groupCollapsed:L({},t,{value:k}),groupEnd:L({},t,{value:B})})}S<0&&x("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Ce=z.ReactCurrentDispatcher,Te;function ve(t,a,p){{if(Te===void 0)try{throw Error()}catch(R){var T=R.stack.trim().match(/\n( *(at )?)/);Te=T&&T[1]||""}return`
`+Te+t}}var je=!1,ye;{var jt=typeof WeakMap=="function"?WeakMap:Map;ye=new jt}function qe(t,a){if(!t||je)return"";{var p=ye.get(t);if(p!==void 0)return p}var T;je=!0;var R=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var F;F=Ce.current,Ce.current=null,Ve();try{if(a){var A=function(){throw Error()};if(Object.defineProperty(A.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(A,[])}catch(te){T=te}Reflect.construct(t,[],A)}else{try{A.call()}catch(te){T=te}t.call(A.prototype)}}else{try{throw Error()}catch(te){T=te}t()}}catch(te){if(te&&T&&typeof te.stack=="string"){for(var _=te.stack.split(`
`),Q=T.stack.split(`
`),Y=_.length-1,J=Q.length-1;Y>=1&&J>=0&&_[Y]!==Q[J];)J--;for(;Y>=1&&J>=0;Y--,J--)if(_[Y]!==Q[J]){if(Y!==1||J!==1)do if(Y--,J--,J<0||_[Y]!==Q[J]){var ne=`
`+_[Y].replace(" at new "," at ");return t.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",t.displayName)),typeof t=="function"&&ye.set(t,ne),ne}while(Y>=1&&J>=0);break}}}finally{je=!1,Ce.current=F,Tt(),Error.prepareStackTrace=R}var de=t?t.displayName||t.name:"",le=de?ve(de):"";return typeof t=="function"&&ye.set(t,le),le}function _t(t,a,p){return qe(t,!1)}function Ut(t){var a=t.prototype;return!!(a&&a.isReactComponent)}function we(t,a,p){if(t==null)return"";if(typeof t=="function")return qe(t,Ut(t));if(typeof t=="string")return ve(t);switch(t){case u:return ve("Suspense");case g:return ve("SuspenseList")}if(typeof t=="object")switch(t.$$typeof){case d:return _t(t.render);case m:return we(t.type,a,p);case P:{var T=t,R=T._payload,F=T._init;try{return we(F(R),a,p)}catch{}}}return""}var me=Object.prototype.hasOwnProperty,Be={},He=z.ReactDebugCurrentFrame;function Ee(t){if(t){var a=t._owner,p=we(t.type,t._source,a?a.type:null);He.setExtraStackFrame(p)}else He.setExtraStackFrame(null)}function At(t,a,p,T,R){{var F=Function.call.bind(me);for(var A in t)if(F(t,A)){var _=void 0;try{if(typeof t[A]!="function"){var Q=Error((T||"React class")+": "+p+" type `"+A+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof t[A]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Q.name="Invariant Violation",Q}_=t[A](a,A,T,p,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Y){_=Y}_&&!(_ instanceof Error)&&(Ee(R),x("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",T||"React class",p,A,typeof _),Ee(null)),_ instanceof Error&&!(_.message in Be)&&(Be[_.message]=!0,Ee(R),x("Failed %s type: %s",p,_.message),Ee(null))}}}var It=Array.isArray;function _e(t){return It(t)}function Pt(t){{var a=typeof Symbol=="function"&&Symbol.toStringTag,p=a&&t[Symbol.toStringTag]||t.constructor.name||"Object";return p}}function $t(t){try{return Ye(t),!1}catch{return!0}}function Ye(t){return""+t}function Ke(t){if($t(t))return x("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Pt(t)),Ye(t)}var Je=z.ReactCurrentOwner,Dt={key:!0,ref:!0,__self:!0,__source:!0},Ge,Xe;function Ot(t){if(me.call(t,"ref")){var a=Object.getOwnPropertyDescriptor(t,"ref").get;if(a&&a.isReactWarning)return!1}return t.ref!==void 0}function zt(t){if(me.call(t,"key")){var a=Object.getOwnPropertyDescriptor(t,"key").get;if(a&&a.isReactWarning)return!1}return t.key!==void 0}function Mt(t,a){typeof t.ref=="string"&&Je.current}function Rt(t,a){{var p=function(){Ge||(Ge=!0,x("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",a))};p.isReactWarning=!0,Object.defineProperty(t,"key",{get:p,configurable:!0})}}function Lt(t,a){{var p=function(){Xe||(Xe=!0,x("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",a))};p.isReactWarning=!0,Object.defineProperty(t,"ref",{get:p,configurable:!0})}}var Ft=function(t,a,p,T,R,F,A){var _={$$typeof:e,type:t,key:a,ref:p,props:A,_owner:F};return _._store={},Object.defineProperty(_._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(_,"_self",{configurable:!1,enumerable:!1,writable:!1,value:T}),Object.defineProperty(_,"_source",{configurable:!1,enumerable:!1,writable:!1,value:R}),Object.freeze&&(Object.freeze(_.props),Object.freeze(_)),_};function Wt(t,a,p,T,R){{var F,A={},_=null,Q=null;p!==void 0&&(Ke(p),_=""+p),zt(a)&&(Ke(a.key),_=""+a.key),Ot(a)&&(Q=a.ref,Mt(a,R));for(F in a)me.call(a,F)&&!Dt.hasOwnProperty(F)&&(A[F]=a[F]);if(t&&t.defaultProps){var Y=t.defaultProps;for(F in Y)A[F]===void 0&&(A[F]=Y[F])}if(_||Q){var J=typeof t=="function"?t.displayName||t.name||"Unknown":t;_&&Rt(A,J),Q&&Lt(A,J)}return Ft(t,_,Q,R,T,Je.current,A)}}var Ue=z.ReactCurrentOwner,Ze=z.ReactDebugCurrentFrame;function ue(t){if(t){var a=t._owner,p=we(t.type,t._source,a?a.type:null);Ze.setExtraStackFrame(p)}else Ze.setExtraStackFrame(null)}var Ae;Ae=!1;function Ie(t){return typeof t=="object"&&t!==null&&t.$$typeof===e}function Qe(){{if(Ue.current){var t=h(Ue.current.type);if(t)return`

Check the render method of \``+t+"`."}return""}}function Nt(t){return""}var et={};function Vt(t){{var a=Qe();if(!a){var p=typeof t=="string"?t:t.displayName||t.name;p&&(a=`

Check the top-level render call using <`+p+">.")}return a}}function tt(t,a){{if(!t._store||t._store.validated||t.key!=null)return;t._store.validated=!0;var p=Vt(a);if(et[p])return;et[p]=!0;var T="";t&&t._owner&&t._owner!==Ue.current&&(T=" It was passed a child from "+h(t._owner.type)+"."),ue(t),x('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',p,T),ue(null)}}function rt(t,a){{if(typeof t!="object")return;if(_e(t))for(var p=0;p<t.length;p++){var T=t[p];Ie(T)&&tt(T,a)}else if(Ie(t))t._store&&(t._store.validated=!0);else if(t){var R=D(t);if(typeof R=="function"&&R!==t.entries)for(var F=R.call(t),A;!(A=F.next()).done;)Ie(A.value)&&tt(A.value,a)}}}function qt(t){{var a=t.type;if(a==null||typeof a=="string")return;var p;if(typeof a=="function")p=a.propTypes;else if(typeof a=="object"&&(a.$$typeof===d||a.$$typeof===m))p=a.propTypes;else return;if(p){var T=h(a);At(p,t.props,"prop",T,t)}else if(a.PropTypes!==void 0&&!Ae){Ae=!0;var R=h(a);x("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",R||"Unknown")}typeof a.getDefaultProps=="function"&&!a.getDefaultProps.isReactClassApproved&&x("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Bt(t){{for(var a=Object.keys(t.props),p=0;p<a.length;p++){var T=a[p];if(T!=="children"&&T!=="key"){ue(t),x("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",T),ue(null);break}}t.ref!==null&&(ue(t),x("Invalid attribute `ref` supplied to `React.Fragment`."),ue(null))}}var nt={};function ot(t,a,p,T,R,F){{var A=v(t);if(!A){var _="";(t===void 0||typeof t=="object"&&t!==null&&Object.keys(t).length===0)&&(_+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Q=Nt();Q?_+=Q:_+=Qe();var Y;t===null?Y="null":_e(t)?Y="array":t!==void 0&&t.$$typeof===e?(Y="<"+(h(t.type)||"Unknown")+" />",_=" Did you accidentally export a JSX literal instead of a component?"):Y=typeof t,x("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Y,_)}var J=Wt(t,a,p,R,F);if(J==null)return J;if(A){var ne=a.children;if(ne!==void 0)if(T)if(_e(ne)){for(var de=0;de<ne.length;de++)rt(ne[de],t);Object.freeze&&Object.freeze(ne)}else x("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else rt(ne,t)}if(me.call(a,"key")){var le=h(t),te=Object.keys(a).filter(function(Xt){return Xt!=="key"}),Pe=te.length>0?"{key: someKey, "+te.join(": ..., ")+": ...}":"{key: someKey}";if(!nt[le+Pe]){var Gt=te.length>0?"{"+te.join(": ..., ")+": ...}":"{}";x(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Pe,le,Gt,le),nt[le+Pe]=!0}}return t===o?Bt(J):qt(J),J}}function Ht(t,a,p){return ot(t,a,p,!0)}function Yt(t,a,p){return ot(t,a,p,!1)}var Kt=Yt,Jt=Ht;ge.Fragment=o,ge.jsx=Kt,ge.jsxs=Jt}()),ge}process.env.NODE_ENV==="production"?Se.exports=it():Se.exports=at();var i=Se.exports;class ie{static detect(){const e=this.getFromUrl();if(e)return this.save(e),this.cleanUrl(),console.info("[MagicToken] Token detected in URL and saved."),e;const r=this.get();return r?console.info("[MagicToken] Token loaded from localStorage."):console.warn("[MagicToken] No token found in URL or localStorage."),r}static getFromUrl(){const r=new URLSearchParams(window.location.search).get(this.URL_PARAM);return r&&this.isValidFormat(r)?(console.debug("[MagicToken] Token found in URL param."),r):(r&&console.warn("[MagicToken] Token in URL param is not a valid JWT format."),null)}static cleanUrl(){const e=new URL(window.location.href);e.searchParams.has(this.URL_PARAM)&&(e.searchParams.delete(this.URL_PARAM),window.history.replaceState({},"",e.toString()),console.debug("[MagicToken] magic_token param removed from URL."))}static isValidFormat(e){const r=e.split(".").length===3;return r||console.error("[MagicToken] Invalid token format (not JWT-like)."),r}static save(e){if(!this.isValidFormat(e)){console.error("[MagicToken] Refused to save invalid token.");return}localStorage.setItem(this.STORAGE_KEY,e),console.info("[MagicToken] Token saved in localStorage.")}static get(){const e=localStorage.getItem(this.STORAGE_KEY);return console.debug(e?"[MagicToken] get() -> token found.":"[MagicToken] get() -> no token found."),e}static clear(){localStorage.removeItem(this.STORAGE_KEY),console.info("[MagicToken] Token cleared from localStorage.")}static exists(){const e=!!this.get();return console.debug(`[MagicToken] exists() -> ${e}`),e}static parsePayload(e){try{const[,r]=e.split("."),o=JSON.parse(atob(r));return console.debug("[MagicToken] Payload parsed:",o),o}catch(r){return console.error("[MagicToken] Failed to parse payload:",r),null}}static isExpired(e){const r=this.parsePayload(e);if(!(r!=null&&r.exp))return console.warn("[MagicToken] No exp claim in token, treating as expired."),!0;const o=Date.now()>=r.exp*1e3;return o?console.warn("[MagicToken] Token is expired."):console.debug("[MagicToken] Token is valid (not expired)."),o}}fe(ie,"STORAGE_KEY","inline_editor_token"),fe(ie,"URL_PARAM","magic_token");const Oe=n.createContext(null),se=()=>{const f=n.useContext(Oe);if(!f)throw new Error("useAuth must be used within AuthProvider");return f},st=({children:f})=>{const[e,r]=n.useState(!1),[o,l]=n.useState(null),c="https://api.example.com";n.useEffect(()=>{(async()=>{console.group("[AuthProvider] Init auth");const g=ie.detect();if(!g){console.warn("[AuthProvider] No token detected. User is not authenticated."),r(!1),l(null),console.groupEnd();return}if(ie.isExpired(g)){console.warn("[AuthProvider] Token is expired. Clearing..."),ie.clear(),r(!1),l(null),console.groupEnd();return}try{console.info("[AuthProvider] Token is valid. Fetching user info...");const m=await b(g);m?(r(!0),l(m),console.info("[AuthProvider] User authenticated:",m)):(r(!1),l(null),console.warn("[AuthProvider] Token valid but user fetch failed."))}catch(m){r(!1),l(null),console.error("[AuthProvider] Error fetching user:",m)}console.groupEnd()})()},[]);const s=()=>{ie.clear(),r(!1),l(null),console.info("[AuthProvider] User logged out.")},b=async u=>{try{const g=await fetch(`${c}/wp-json/wp/v2/users/me`,{headers:{Authorization:`Bearer ${u}`}});if(!g.ok)return console.warn("[AuthProvider] fetchUser: API responded",g.status),null;const m=await g.json();return console.debug("[AuthProvider] fetchUser: API returned",m),m}catch(g){return console.error("[AuthProvider] fetchUser: Error",g),null}},d={isAuthenticated:e,user:o,logout:s};return i.jsx(Oe.Provider,{value:d,children:f})},ze=n.createContext(null),he=()=>{const f=n.useContext(ze);if(!f)throw new Error("useNotifications must be used within NotificationProvider");return f},lt=({children:f})=>{const d={success:(u,g)=>{ee.success(u,{duration:4e3,position:"top-right",style:{background:"rgba(16, 185, 129, 0.1)",backdropFilter:"blur(12px)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:"12px",color:"#065f46",fontWeight:"500",fontSize:"14px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},icon:i.jsx(oe.CheckCircle,{size:20,className:"text-emerald-600"}),...g})},error:(u,g)=>{ee.error(u,{duration:6e3,position:"top-right",style:{background:"rgba(239, 68, 68, 0.1)",backdropFilter:"blur(12px)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px",color:"#991b1b",fontWeight:"500",fontSize:"14px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},icon:i.jsx(oe.XCircle,{size:20,className:"text-red-600"}),...g})},warning:(u,g)=>{ee(u,{duration:5e3,position:"top-right",style:{background:"rgba(245, 158, 11, 0.1)",backdropFilter:"blur(12px)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:"12px",color:"#92400e",fontWeight:"500",fontSize:"14px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},icon:i.jsx(oe.AlertCircle,{size:20,className:"text-amber-600"}),...g})},info:(u,g)=>{ee(u,{duration:4e3,position:"top-right",style:{background:"rgba(59, 130, 246, 0.1)",backdropFilter:"blur(12px)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"12px",color:"#1e40af",fontWeight:"500",fontSize:"14px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},icon:i.jsx(oe.Info,{size:20,className:"text-blue-600"}),...g})},loading:(u,g)=>ee.loading(u,{position:"top-right",style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(12px)",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"12px",color:"#374151",fontWeight:"500",fontSize:"14px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},...g}),dismiss:u=>{u?ee.dismiss(u):ee.dismiss()},promise:(u,g)=>ee.promise(u,g,{position:"top-right",style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(12px)",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"12px",fontWeight:"500",fontSize:"14px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},success:{style:{background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",color:"#065f46"}},error:{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#991b1b"}}})};return i.jsxs(ze.Provider,{value:d,children:[f,i.jsx(ee.Toaster,{position:"top-right",gutter:12,containerStyle:{top:80,right:20},toastOptions:{duration:4e3,style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(12px)",border:"1px solid rgba(0, 0, 0, 0.1)",borderRadius:"12px",color:"#374151",fontWeight:"500",fontSize:"14px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}}})]})};function ct(f,e){const r=n.useRef();return n.useCallback((...o)=>{r.current&&clearTimeout(r.current),r.current=window.setTimeout(()=>{f(...o)},e)},[f,e])}class ke{constructor(e){fe(this,"baseUrl");fe(this,"config",{timeout:3e4,maxRetries:3,retryDelay:1e3});this.baseUrl=(e||void 0||"https://www.wow.cryptonic-drinks.com").replace(/\/+$/,""),console.log("[ApiService] Initialized with base URL:",this.baseUrl)}getAuthToken(){return localStorage.getItem("inline_editor_token")}getHeaders(e=!1){const r={"Content-Type":"application/json"};if(e){const o=this.getAuthToken();o&&(r.Authorization=`Bearer ${o}`)}return r}async fetchWithTimeout(e,r){const o=new AbortController,l=setTimeout(()=>o.abort(),this.config.timeout);try{const c=await fetch(e,{...r,signal:o.signal});return clearTimeout(l),c}catch(c){throw clearTimeout(l),c instanceof Error&&c.name==="AbortError"?new Error("Request timeout"):c}}async fetchWithRetry(e,r={},o=this.config.maxRetries){let l=null;for(let c=0;c<o;c++)try{const s=await this.fetchWithTimeout(e,{...r,headers:{...this.getHeaders(),...r.headers}});if(!s.ok){const d=new Error(`HTTP ${s.status}: ${s.statusText}`);if(d.status=s.status,s.status>=400&&s.status<500)throw d;l=d;continue}return await s.json()}catch(s){if(l=s,s instanceof SyntaxError||s instanceof Error&&"status"in s&&s.status>=400&&s.status<500)throw s;if(c<o-1){const b=this.config.retryDelay*Math.pow(2,c);console.log(`[ApiService] Retry attempt ${c+1}/${o} after ${b}ms`),await new Promise(d=>setTimeout(d,b))}}throw l||new Error("Request failed after all retries")}async loadAllContents(){console.log("[ApiService] Loading all contents from:",`${this.baseUrl}/wp-json/api/editable-content`);try{const e=await this.fetchWithRetry(`${this.baseUrl}/wp-json/api/editable-content`,{headers:this.getHeaders(!0)});if(!Array.isArray(e))throw new Error("Invalid response format: expected array");const r=e.filter(o=>o.context&&o.context_id).map(o=>({editable_id:o.editable_id,content:o.content||"",context:o.context,context_id:o.context_id,version:o.version||0,contentType:o.content_type||"text",lastModified:Date.now()}));return console.log(`[ApiService] Loaded ${r.length} contents`),r}catch(e){throw console.error("[ApiService] Failed to load contents:",e),this.handleApiError(e)}}async saveContent(e,r){if(console.log("[ApiService] Saving content to:",`${this.baseUrl}/wp-json/api/editable-content/save`),console.log("[ApiService] Content context_id:",e.context_id),console.log("[ApiService] User edited content:",e.content),console.log("[ApiService] Default content (for reference):",r),!this.getAuthToken())throw new Error("Authentication required for saving content");if(!e.context||!e.context_id)throw new Error("Context and context_id are required");const l=!e.editable_id&&!e.version&&r!==void 0,c={content:e.content,context:e.context,context_id:e.context_id,content_type:e.contentType||"text"};e.version&&(c.version=e.version),l&&(c.isDefaultContent=!0,c.defaultContent=r),console.log("[ApiService] Request body:",c);try{const s=await this.fetchWithRetry(`${this.baseUrl}/wp-json/api/editable-content/save`,{method:"POST",headers:this.getHeaders(!0),body:JSON.stringify(c)});switch(console.log("[ApiService] Save response:",s),s.status){case"success":case"no_action":case"no_change":if(!s.data)throw new Error("No data returned from save operation");return{content:{...e,editable_id:s.data.editable_id,content:s.data.content,version:s.data.version,contentType:s.data.content_type,lastModified:Date.now()},status:s.status,message:s.message};case"conflict":throw s.conflict?Object.assign(new Error(s.message),{type:"VERSION_CONFLICT",conflict:s.conflict}):new Error("Conflict response missing conflict data");case"error":default:throw new Error(s.message||"Save operation failed")}}catch(s){throw console.error("[ApiService] Save failed:",s),this.handleApiError(s)}}handleApiError(e){return e instanceof Error?"type"in e&&e.type==="VERSION_CONFLICT"?e:e.message==="Request timeout"?new Error("La requête a expiré. Vérifiez votre connexion internet."):"status"in e&&e.status===401?new Error("Session expirée. Veuillez vous reconnecter."):"status"in e&&e.status===403?new Error("Vous n'avez pas les permissions nécessaires."):e:new Error("Une erreur inattendue s'est produite")}isAuthenticated(){return!!this.getAuthToken()}async testConnection(){try{return await this.fetchWithRetry(`${this.baseUrl}/wp-json/api/editable-content`,{method:"HEAD"},1),!0}catch{return!1}}static isVersionConflictError(e){return e instanceof Error&&"type"in e&&e.type==="VERSION_CONFLICT"&&"conflict"in e}static getConflictInfo(e){return this.isVersionConflictError(e)?e.conflict:null}async getContentByContext(e,r){console.log("[ApiService] Getting content by context:",e,r);try{const o=new URLSearchParams({context:e,context_id:r}),l=await this.fetchWithRetry(`${this.baseUrl}/wp-json/api/editable-content/get?${o.toString()}`,{headers:this.getHeaders(!1)});return l.exists?{editable_id:l.editable_id,content:l.content||"",context:l.context,context_id:l.context_id,version:l.version||0,contentType:l.content_type||"text",lastModified:l.updated_at?new Date(l.updated_at).getTime():Date.now()}:null}catch(o){throw console.error("[ApiService] Failed to get content by context:",o),this.handleApiError(o)}}clearAuthToken(){console.log("[ApiService] Auth token cleared")}static isAuthError(e){return e instanceof Error&&"status"in e&&e.status===401}static isPermissionError(e){return e instanceof Error&&"status"in e&&e.status===403}getStats(){return{totalRequests:0,failedRequests:0,avgResponseTime:0}}getConfig(){return{baseUrl:this.baseUrl,timeout:this.config.timeout,maxRetries:this.config.maxRetries}}}const Me=n.createContext(null),be=()=>{const f=n.useContext(Me);if(!f)throw new Error("useContent must be used within ContentProvider");return f},ut=({children:f,apiBaseUrl:e,onVersionConflict:r})=>{const{isAuthenticated:o}=se(),{error:l,warning:c,promise:s}=he(),[b,d]=n.useState(!0),[u,g]=n.useState({}),m=n.useRef(new Map),P=5*60*1e3,C=e||void 0,[$]=n.useState(()=>new ke(C)),V=ct(async(v,w)=>await I(v,w),500),D=n.useCallback((v,w)=>{if(!(v!=null&&v.trim())||!(w!=null&&w.trim()))throw new Error("Context and contextId are required and cannot be empty");return`${v}#${w}`},[]),z=n.useCallback(v=>{const w=m.current.get(v);return w&&Date.now()-w.timestamp<P?w.content:(m.current.delete(v),null)},[]),x=n.useCallback((v,w)=>{m.current.set(v,{content:w,timestamp:Date.now()})},[]),N=n.useCallback((v,w,j)=>{if(!(v!=null&&v.trim())||!(w!=null&&w.trim()))return console.warn("[ContentProvider] getContent called with empty context or contextId"),j;try{const h=D(v,w),L=z(h);if(L)return L.content;const S=u[h];return S?(x(h,S),S.content):j}catch(h){return console.error("[ContentProvider] Error in getContent:",h),j}},[u,D,z,x]),I=n.useCallback(async(v,w)=>{var L,S;if(!((L=v.context)!=null&&L.trim())||!((S=v.context_id)!=null&&S.trim()))return console.error("[ContentProvider] Cannot save: context and context_id are required"),l("Invalid content configuration"),!1;if(!o)return console.error("[ContentProvider] Cannot save: authentication required"),c("Please log in to save changes"),!1;const j=D(v.context,v.context_id),h=u[j];try{const H={...v,lastModified:Date.now()};g(q=>({...q,[j]:H})),x(j,H);const M={...v,...h&&{editable_id:h.editable_id,version:h.version}},U=await $.saveContent(M,!h&&w!==void 0?w:void 0);switch(U.status){case"success":case"no_action":const q=U.content;return g(Z=>({...Z,[j]:q})),x(j,q),!0;case"no_change":return c("No changes detected"),!0;default:throw new Error(`Unexpected status: ${U.status}`)}}catch(H){if(console.error("[ContentProvider] Save failed:",H),g(M=>{const U={...M};return h?(U[j]=h,x(j,h)):(delete U[j],m.current.delete(j)),U}),ke.isVersionConflictError(H)){const M=ke.getConflictInfo(H);if(M&&r)switch(await r({clientVersion:M.client_version,serverVersion:M.server_version,serverContent:M.server_content,clientContent:v.content})){case"overwrite":const q={...v,version:M.server_version,editable_id:M.editable_id};return I(q);case"keep_server":const Z={...v,content:M.server_content,version:M.server_version,editable_id:M.editable_id,lastModified:Date.now()};return g(k=>({...k,[j]:Z})),x(j,Z),c("Using server version of content"),!1;case"cancel":default:return c("Save cancelled"),!1}else l("Content was modified by another user. Please refresh to get the latest version.")}return!1}},[o,D,$,u,r,l,c,x]),G=n.useCallback(async(v,w)=>V(v,w),[V]),X=n.useCallback(v=>{const w={};for(const j of v)if(j.context&&j.context_id){const h=D(j.context,j.context_id);w[h]=j}return w},[D]),E=n.useCallback(async()=>{try{const v=await $.loadAllContents(),w=X(v);g(w),Object.entries(w).forEach(([j,h])=>{x(j,h)}),Object.keys(w).length>0&&o&&console.log(`[ContentProvider] Successfully loaded ${Object.keys(w).length} editable contents`)}catch(v){throw console.error("[ContentProvider] Failed to load contents:",v),l("Failed to load content. Please refresh the page."),v}},[$,X,l,o,x]);n.useEffect(()=>{(async()=>{d(!0);try{await E()}catch(w){console.error("[ContentProvider] Initialization failed:",w)}finally{d(!1)}})()},[o,E]);const y=n.useCallback(async()=>{d(!0);try{await s(E(),{loading:"Refreshing content...",success:"Content refreshed successfully!",error:"Failed to refresh content"})}finally{d(!1)}},[E,s]),O={isLoading:b,contents:u,getContent:N,saveContent:G,refreshContents:y};return i.jsx(Me.Provider,{value:O,children:f})},dt=()=>{const[f,e]=n.useState(!1);return null},ft=({content:f,onSave:e,onCancel:r,config:o,className:l="",style:c={},as:s="span"})=>{const[b,d]=n.useState(!1),[u,g]=n.useState(!1),m=n.useRef(null),P=n.useRef(f),{success:C,error:$,loading:V,dismiss:D}=he();n.useEffect(()=>{if(m.current){m.current.focus();const E=document.createRange(),y=window.getSelection();E.selectNodeContents(m.current),E.collapse(!1),y==null||y.removeAllRanges(),y==null||y.addRange(E)}},[]);const z=n.useCallback(()=>m.current&&m.current.innerText||"",[]),x=n.useCallback(()=>{const E=z();g(E!==P.current)},[z]),N=n.useCallback(E=>{E.key==="Escape"?(E.preventDefault(),r()):((E.ctrlKey||E.metaKey)&&E.key==="Enter"||(E.ctrlKey||E.metaKey)&&E.key==="s")&&(E.preventDefault(),I()),!o.multiline&&E.key==="Enter"&&E.preventDefault()},[r,o.multiline]),I=n.useCallback(async()=>{const E=z();if(b)return;if(E===P.current){C("No changes to save"),r();return}d(!0);const y=V("Saving changes...");try{const O=await e(E);D(y),O?(C("Changes saved successfully"),P.current=E,g(!1)):$("Failed to save changes")}catch(O){D(y),$("An error occurred while saving"),console.error("[ModernInlineTextEditor] Save error:",O)}finally{d(!1)}},[z,e,b,C,$,V,D,r]),G=n.useCallback(E=>{E.preventDefault();const y=E.clipboardData.getData("text/plain"),O=o.multiline?y:y.replace(/\n/g," ");document.execCommand("insertText",!1,O),x()},[o.multiline,x]),X=n.useCallback(E=>{const y=E.relatedTarget;y!=null&&y.closest(".inline-editor-actions-modern")||u&&!b&&I()},[u,b,I]);return i.jsxs("div",{className:"inline-editor-container-modern",children:[i.jsx("div",{ref:m,contentEditable:!0,suppressContentEditableWarning:!0,onKeyDown:N,onPaste:G,onBlur:X,onInput:x,className:`inline-editor-content-modern ${l}`,style:{...c,outline:"none",border:"none",background:"transparent",minHeight:"inherit",minWidth:"inherit",display:"inherit",fontFamily:"inherit",fontSize:"inherit",fontWeight:"inherit",lineHeight:"inherit",color:"inherit",textAlign:"inherit",textDecoration:"inherit",textTransform:"inherit",letterSpacing:"inherit",wordSpacing:"inherit",margin:"0",padding:"0"},"data-placeholder":o.placeholder||"Enter text...",role:"textbox","aria-label":`Edit ${o.id}`,"aria-multiline":o.multiline,children:f}),i.jsxs("div",{className:"inline-editor-actions-modern",style:{position:"absolute",top:"-2.5rem",right:"0",display:"flex",gap:"0.25rem",zIndex:1e3,opacity:u||b?1:.7},children:[i.jsx("button",{onClick:I,disabled:b||!u,className:"inline-editor-btn-modern save",title:`Save changes ${o.multiline?"(Ctrl+Enter)":"(Enter)"}`,onMouseDown:E=>E.preventDefault(),style:{width:"1.75rem",height:"1.75rem",background:u?"#10b981":"#6b7280",color:"white",border:"none",borderRadius:"0.375rem",cursor:b||!u?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",opacity:b||!u?.6:1},"aria-label":"Save changes",children:b?i.jsx(oe.Loader2,{size:12,className:"animate-spin"}):i.jsx(oe.Save,{size:12})}),i.jsx("button",{onClick:r,disabled:b,className:"inline-editor-btn-modern cancel",title:"Cancel (Escape)",onMouseDown:E=>E.preventDefault(),style:{width:"1.75rem",height:"1.75rem",background:"#ef4444",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem"},"aria-label":"Cancel editing",children:i.jsx(oe.X,{size:12})})]})]})},pt=n.memo(ft);function gt(f){const e=window.location.pathname;if(!f)return{path:e,sectionId:0,sectionSelector:"body"};const r=ht(f);return{path:e,sectionId:r.id,sectionSelector:r.selector}}function ht(f){var o;let e=f.parentElement;for(;e&&e.tagName!=="BODY";){if(e.id&&Re(e))return{id:bt(e.id),selector:`#${e.id}`};if(e.hasAttribute("data-section-id")){const l=e.getAttribute("data-section-id");return{id:parseInt(l||"0",10),selector:e.id?`#${e.id}`:`[data-section-id="${l}"]`}}if(Re(e)){const l=Array.from(((o=e.parentElement)==null?void 0:o.children)||[]).indexOf(e);return{id:l+1,selector:`${e.tagName.toLowerCase()}:nth-child(${l+1})`}}e=e.parentElement}return document.querySelector("main")?{id:1,selector:"main"}:{id:0,selector:"body"}}function Re(f){return["SECTION","ARTICLE","MAIN","HEADER","FOOTER","ASIDE"].includes(f.tagName)||f.hasAttribute("data-section")||f.classList.contains("section")}function bt(f){let e=0;for(let r=0;r<f.length;r++){const o=f.charCodeAt(r);e=(e<<5)-e+o,e=e&e}return Math.abs(e)}function xe(f){const e=gt(f);return`${e.path}#${e.sectionSelector}`}const K={colors:{primary:{50:"#eff6ff",100:"#dbeafe"},neutral:{100:"#f3f4f6",200:"#e5e7eb",800:"#1f2937"}},spacing:{xs:"0.25rem",sm:"0.5rem"},borderRadius:{sm:"0.375rem",md:"0.5rem"},shadows:{lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},typography:{fontSize:{xs:["0.75rem",{lineHeight:"1rem"}]},fontWeight:{medium:"500"}},animation:{duration:{fast:"150ms"},easing:{ease:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0, 0, 0.2, 1)"}}},mt=({children:f,id:e,multiline:r=!0,maxLength:o,placeholder:l,className:c="",as:s="span",showEditableHighlights:b=!1})=>{const{isAuthenticated:d}=se(),{getContent:u,saveContent:g,isLoading:m}=be(),{error:P,promise:C}=he(),[$,V]=n.useState(!1),[D,z]=n.useState(!1),[x,N]=n.useState(""),[I,G]=n.useState(""),[X,E]=n.useState(""),[y,O]=n.useState(!1),v=n.useRef(null),w=n.useCallback(S=>typeof S=="string"?S:typeof S=="number"?S.toString():S?n.isValidElement(S)&&S.props.children?w(S.props.children):Array.isArray(S)?S.map(w).join(""):"":"",[]);n.useEffect(()=>{if(m||!v.current)return;const S=w(f).trim();E(S);const H=xe(v.current);N(H);const M=u(H,e,S);G(M),O(!0),console.log("[ModernEditableWrapper] Initialized:",{context:H,contextId:e,defaultContent:S,currentContent:M})},[e,f,u,w,m]);const j=n.useCallback(S=>{S.stopPropagation(),d&&!$&&x&&V(!0)},[d,$,x]),h=n.useCallback(async S=>{if(!x)return P("Cannot save: invalid configuration"),!1;const H={content:S,context:x,context_id:e,contentType:"text",lastModified:Date.now()};try{const M=await C(g(H,X),{loading:"Saving changes...",success:"Changes saved successfully!",error:"Failed to save changes"});return M&&(G(S),V(!1)),M}catch(M){return console.error("[ModernEditableWrapper] Save error:",M),!1}},[x,e,g,X,P,C]),L=n.useCallback(()=>{V(!1)},[]);return m||!y?n.createElement(s,{ref:v,className:`modern-editable-skeleton ${c}`,style:{background:`linear-gradient(90deg, ${K.colors.neutral[200]} 25%, ${K.colors.neutral[100]} 50%, ${K.colors.neutral[200]} 75%)`,backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite",borderRadius:K.borderRadius.sm,minHeight:"1.25rem",minWidth:"4rem"}}):$&&d?i.jsx(pt,{content:I,onSave:h,onCancel:L,config:{id:e,multiline:r,maxLength:o,placeholder:l},className:c,as:s,preserveStyles:!0}):i.jsxs(ae.motion.div,{style:{position:"relative",display:"inline-block"},onHoverStart:()=>z(!0),onHoverEnd:()=>z(!1),children:[n.createElement(s,{ref:v,className:`modern-editable-wrapper ${d?"is-authenticated":""} ${b?"show-highlights":""} ${c}`,onClick:j,onKeyDown:d?S=>{(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),j(S))}:void 0,style:{position:"relative",cursor:d?"pointer":"default",outline:"none",borderRadius:K.borderRadius.sm,transition:`all ${K.animation.duration.fast} ${K.animation.easing.ease}`,...d&&{outline:"2px solid transparent",outlineOffset:"1px"},...d&&D&&{outline:`2px solid ${K.colors.primary[100]}`,backgroundColor:`${K.colors.primary[50]}`},...b&&d&&{outline:`2px dashed ${K.colors.primary[100]}`,backgroundColor:`${K.colors.primary[50]}`}},title:d?"Click to edit":void 0,"data-context":x,"data-context-id":e,role:d?"button":void 0,tabIndex:d?0:void 0,"aria-label":d?`Edit ${e}`:void 0},I),i.jsx(ae.AnimatePresence,{children:d&&D&&!$&&i.jsxs(ae.motion.div,{initial:{opacity:0,scale:.8,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10},transition:{duration:.2,ease:K.animation.easing.easeOut},style:{position:"absolute",top:"-2rem",right:"0",background:K.colors.neutral[800],color:"white",padding:`${K.spacing.xs} ${K.spacing.sm}`,borderRadius:K.borderRadius.md,fontSize:K.typography.fontSize.xs[0],fontWeight:K.typography.fontWeight.medium,boxShadow:K.shadows.lg,zIndex:1e3,pointerEvents:"none",whiteSpace:"nowrap"},children:["✏️ Click to edit",i.jsx("div",{style:{position:"absolute",bottom:"-4px",right:"8px",width:"8px",height:"8px",background:K.colors.neutral[800],transform:"rotate(45deg)"}})]})})]})},xt=n.memo(mt),Le=({showEditableHighlights:f,toggleEditableHighlights:e})=>{const{isAuthenticated:r,logout:o,user:l}=se(),{success:c,info:s}=he();if(!r)return null;const b=()=>{o(),c("Successfully logged out")},d=()=>{e(),s(f?"Edit highlights hidden":"Edit highlights shown")};return i.jsxs(ae.motion.div,{className:"global-editor-toolbar-modern",initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{duration:.3,ease:"easeOut"},children:[i.jsxs(ae.motion.div,{className:"flex items-center gap-2 px-3 py-2 bg-blue-50 rounded-lg border border-blue-200",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1},children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),i.jsx("span",{className:"text-xs font-medium text-blue-800",children:(l==null?void 0:l.name)||"Editor"})]}),i.jsx(ae.motion.button,{onClick:d,className:`global-editor-toolbar-btn-modern ${f?"active":""}`,title:f?"Hide editable highlights":"Show editable highlights",whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.2},children:f?i.jsx(oe.EyeOff,{size:18}):i.jsx(oe.Eye,{size:18})}),i.jsx(ae.motion.button,{className:"global-editor-toolbar-btn-modern",title:"Editor settings",whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.3},onClick:()=>s("Settings panel coming soon"),children:i.jsx(oe.Settings,{size:18})}),i.jsx(ae.motion.button,{onClick:b,className:"global-editor-toolbar-btn-modern logout",title:"Logout",whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.4},children:i.jsx(oe.LogOut,{size:18})})]})};class ce{constructor(e){fe(this,"baseUrl");this.baseUrl=(e||void 0||"https://www.wow.cryptonic-drinks.com").replace(/\/+$/,""),console.log("[MediaUploadService] Initialized with base URL:",this.baseUrl)}async uploadFile(e,r){console.log("[MediaUploadService] Uploading file:",e.name,e.type,e.size);const o=this.validateFile(e);if(!o.valid)return{success:!1,error:o.error};const l=ie.get();if(!l)return{success:!1,error:"Authentication required"};const c=new FormData;c.append("file",e),c.append("title",e.name.replace(/\.[^/.]+$/,"")),c.append("alt",e.name.replace(/\.[^/.]+$/,""));try{const s=new XMLHttpRequest,b=new Promise((d,u)=>{s.onload=()=>{if(s.status>=200&&s.status<300)try{const g=JSON.parse(s.responseText);console.log("[MediaUploadService] Upload successful:",g),d(this.formatResponse(g))}catch{u(new Error("Invalid response format"))}else u(new Error(`Upload failed: ${s.status} ${s.statusText}`))},s.onerror=()=>u(new Error("Network error")),s.onabort=()=>u(new Error("Upload cancelled"))});return r&&(s.upload.onprogress=d=>{d.lengthComputable&&r({loaded:d.loaded,total:d.total,percentage:Math.round(d.loaded/d.total*100)})}),s.open("POST",`${this.baseUrl}/wp-json/wp/v2/media`),s.setRequestHeader("Authorization",`Bearer ${l}`),s.send(c),await b}catch(s){return console.error("[MediaUploadService] Upload error:",s),{success:!1,error:s instanceof Error?s.message:"Upload failed"}}}async uploadFromUrl(e,r){console.log("[MediaUploadService] Uploading from URL:",e);const o=this.validateUrl(e);if(!o.valid)return{success:!1,error:o.error};const l=ie.get();if(!l)return{success:!1,error:"Authentication required"};try{const c=await fetch(`${this.baseUrl}/wp-json/api/media/import-url`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({url:e,filename:r||this.extractFilenameFromUrl(e),title:(r==null?void 0:r.replace(/\.[^/.]+$/,""))||"Imported image",alt:(r==null?void 0:r.replace(/\.[^/.]+$/,""))||"Imported image"})});if(!c.ok){const b=await c.text();throw new Error(`Import failed: ${c.status} - ${b}`)}const s=await c.json();return console.log("[MediaUploadService] URL import successful:",s),this.formatResponse(s)}catch(c){return console.error("[MediaUploadService] URL import error:",c),{success:!1,error:c instanceof Error?c.message:"Import failed"}}}async deleteMedia(e){const r=ie.get();if(!r)return console.error("[MediaUploadService] No token for deletion"),!1;try{return(await fetch(`${this.baseUrl}/wp-json/wp/v2/media/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})).ok}catch(o){return console.error("[MediaUploadService] Delete error:",o),!1}}async getMediaDetails(e){try{const r=await fetch(`${this.baseUrl}/wp-json/wp/v2/media/${e}`);if(!r.ok)throw new Error("Media not found");return await r.json()}catch(r){return console.error("[MediaUploadService] Get media error:",r),null}}validateFile(e){const r=["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml"];if(!r.includes(e.type))return{valid:!1,error:`Type de fichier non supporté. Formats acceptés: ${r.join(", ")}`};const o=10*1024*1024;return e.size>o?{valid:!1,error:`Fichier trop volumineux. Taille maximale: ${o/1024/1024}MB`}:{valid:!0}}validateUrl(e){try{const r=new URL(e);if(!["http:","https:"].includes(r.protocol))return{valid:!1,error:"URL invalide. Utilisez http:// ou https://"};const o=r.pathname.toLowerCase();return![".jpg",".jpeg",".png",".gif",".webp",".svg"].some(s=>o.endsWith(s))&&!o.includes("image")&&console.warn("[MediaUploadService] URL might not be an image:",e),{valid:!0}}catch{return{valid:!1,error:"URL invalide"}}}extractFilenameFromUrl(e){try{const o=new URL(e).pathname,l=o.substring(o.lastIndexOf("/")+1);return!l||l===""?`image-${Date.now()}.jpg`:l.includes(".")?l:`${l}.jpg`}catch{return`image-${Date.now()}.jpg`}}formatResponse(e){var l,c,s,b,d,u,g;if(!e||!e.id&&!e.ID)return{success:!1,error:"Invalid response from server"};const r=e.id||e.ID,o=e.source_url||((l=e.guid)==null?void 0:l.rendered)||e.url;return{success:!0,data:{id:r,url:o,alt:e.alt_text||"",title:((c=e.title)==null?void 0:c.rendered)||e.title||"",sizes:(s=e.media_details)!=null&&s.sizes?{thumbnail:(b=e.media_details.sizes.thumbnail)==null?void 0:b.source_url,medium:(d=e.media_details.sizes.medium)==null?void 0:d.source_url,large:(u=e.media_details.sizes.large)==null?void 0:u.source_url,full:((g=e.media_details.sizes.full)==null?void 0:g.source_url)||o}:void 0}}}static createPreviewUrl(e){return URL.createObjectURL(e)}static revokePreviewUrl(e){URL.revokeObjectURL(e)}static isUrl(e){try{return new URL(e),!0}catch{return e.startsWith("/")||e.startsWith("./")||e.startsWith("../")}}}const Fe=({isOpen:f,onClose:e,onImageSelected:r})=>{const[o,l]=n.useState("file"),[c,s]=n.useState(!1),[b,d]=n.useState(null),[u,g]=n.useState(""),[m,P]=n.useState(""),[C,$]=n.useState(!1),[V,D]=n.useState(0),[z,x]=n.useState(""),N=n.useRef(null),I=n.useRef(new ce).current;n.useEffect(()=>()=>{u&&!ce.isUrl(u)&&ce.revokePreviewUrl(u)},[u]);const G=n.useCallback(h=>{h.preventDefault(),s(!0)},[]),X=n.useCallback(h=>{h.preventDefault(),s(!1)},[]),E=n.useCallback(h=>{h.preventDefault(),s(!1);const S=Array.from(h.dataTransfer.files).find(H=>H.type.startsWith("image/"));S?y(S):x("Veuillez déposer une image")},[]),y=n.useCallback(h=>{d(h),x(""),u&&!ce.isUrl(u)&&ce.revokePreviewUrl(u);const L=ce.createPreviewUrl(h);g(L)},[u]),O=n.useCallback(async()=>{if(!b){x("Aucun fichier sélectionné");return}$(!0),x(""),D(0);try{const h=await I.uploadFile(b,L=>{D(L.percentage)});h.success&&h.data?(r(h.data.url),e()):x(h.error||"Échec de l'upload")}catch(h){x("Erreur lors de l'upload"),console.error("[ImageUploadModal] Upload error:",h)}finally{$(!1),D(0)}},[b,I,r,e]),v=n.useCallback(async()=>{if(!m.trim()){x("Veuillez entrer une URL");return}$(!0),x("");try{const h=await I.uploadFromUrl(m);h.success&&h.data?(r(h.data.url),e()):x(h.error||"Échec de l'import")}catch(h){x("Erreur lors de l'import"),console.error("[ImageUploadModal] Import error:",h)}finally{$(!1)}},[m,I,r,e]),w=n.useCallback(()=>{if(!m.trim()){x("Veuillez entrer une URL");return}r(m),e()},[m,r,e]),j=n.useCallback(()=>{d(null),g(""),P(""),x(""),l("file"),e()},[e]);return f?i.jsx("div",{className:"image-upload-modal-overlay",onClick:j,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:i.jsxs("div",{className:"image-upload-modal",onClick:h=>h.stopPropagation(),style:{background:"#1f2937",borderRadius:"12px",padding:"24px",maxWidth:"600px",width:"90%",maxHeight:"90vh",overflow:"auto",color:"white"},children:[i.jsx("h2",{style:{margin:"0 0 20px 0",fontSize:"24px"},children:"Modifier l'image"}),i.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"24px"},children:[i.jsx("button",{onClick:()=>l("file"),style:{flex:1,padding:"12px",background:o==="file"?"#3b82f6":"#374151",border:"none",borderRadius:"6px",color:"white",cursor:"pointer",fontSize:"16px",transition:"background 0.2s"},children:"📤 Upload un fichier"}),i.jsx("button",{onClick:()=>l("url"),style:{flex:1,padding:"12px",background:o==="url"?"#3b82f6":"#374151",border:"none",borderRadius:"6px",color:"white",cursor:"pointer",fontSize:"16px",transition:"background 0.2s"},children:"🔗 Depuis une URL"})]}),o==="file"&&i.jsxs("div",{children:[i.jsx("div",{onDragOver:G,onDragLeave:X,onDrop:E,onClick:()=>{var h;return(h=N.current)==null?void 0:h.click()},style:{border:`2px dashed ${c?"#3b82f6":"#6b7280"}`,borderRadius:"8px",padding:"40px",textAlign:"center",cursor:"pointer",background:c?"rgba(59, 130, 246, 0.1)":"rgba(55, 65, 81, 0.5)",transition:"all 0.2s"},children:b?i.jsxs("div",{children:[u&&i.jsx("img",{src:u,alt:"Preview",style:{maxWidth:"300px",maxHeight:"200px",objectFit:"contain",margin:"0 auto 16px"}}),i.jsx("p",{style:{margin:"8px 0",fontSize:"14px"},children:b.name}),i.jsxs("p",{style:{margin:"0",fontSize:"12px",color:"#9ca3af"},children:[(b.size/1024/1024).toFixed(2)," MB"]})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{style:{margin:"0 0 8px 0",fontSize:"18px"},children:"📁 Glissez une image ici"}),i.jsx("p",{style:{margin:"0",fontSize:"14px",color:"#9ca3af"},children:"ou cliquez pour sélectionner"})]})}),i.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:h=>{var S;const L=(S=h.target.files)==null?void 0:S[0];L&&y(L)},style:{display:"none"}}),C&&V>0&&i.jsxs("div",{style:{marginTop:"16px"},children:[i.jsx("div",{style:{background:"#374151",borderRadius:"4px",height:"8px",overflow:"hidden"},children:i.jsx("div",{style:{background:"#3b82f6",height:"100%",width:`${V}%`,transition:"width 0.3s"}})}),i.jsxs("p",{style:{textAlign:"center",marginTop:"8px",fontSize:"14px",color:"#9ca3af"},children:[V,"%"]})]})]}),o==="url"&&i.jsxs("div",{children:[i.jsx("input",{type:"text",value:m,onChange:h=>P(h.target.value),placeholder:"https://example.com/image.jpg",style:{width:"100%",padding:"12px",background:"#374151",border:"1px solid #6b7280",borderRadius:"6px",color:"white",fontSize:"16px"}}),i.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"rgba(59, 130, 246, 0.1)",borderRadius:"6px",fontSize:"14px"},children:[i.jsx("p",{style:{margin:"0 0 8px 0"},children:"💡 Deux options disponibles :"}),i.jsxs("ul",{style:{margin:"0",paddingLeft:"20px"},children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Importer dans WordPress"})," : L'image sera téléchargée et stockée dans votre médiathèque"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Utiliser l'URL directement"})," : L'image restera hébergée sur le site externe"]})]})]})]}),z&&i.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:"6px",color:"#ef4444",fontSize:"14px"},children:["⚠️ ",z]}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:j,disabled:C,style:{padding:"10px 20px",background:"#6b7280",border:"none",borderRadius:"6px",color:"white",cursor:C?"not-allowed":"pointer",fontSize:"16px",opacity:C?.5:1},children:"Annuler"}),o==="file"&&i.jsx("button",{onClick:O,disabled:!b||C,style:{padding:"10px 20px",background:"#10b981",border:"none",borderRadius:"6px",color:"white",cursor:!b||C?"not-allowed":"pointer",fontSize:"16px",opacity:!b||C?.5:1},children:C?"Upload...":"Uploader"}),o==="url"&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:w,disabled:!m.trim()||C,style:{padding:"10px 20px",background:"#3b82f6",border:"none",borderRadius:"6px",color:"white",cursor:!m.trim()||C?"not-allowed":"pointer",fontSize:"16px",opacity:!m.trim()||C?.5:1},children:"Utiliser l'URL"}),i.jsx("button",{onClick:v,disabled:!m.trim()||C,style:{padding:"10px 20px",background:"#10b981",border:"none",borderRadius:"6px",color:"white",cursor:!m.trim()||C?"not-allowed":"pointer",fontSize:"16px",opacity:!m.trim()||C?.5:1},children:C?"Import...":"Importer dans WP"})]})]})]})}):null},vt=({id:f,src:e,alt:r="",className:o="",style:l={},width:c,height:s,loading:b="lazy",showEditableHighlights:d=!1})=>{const{isAuthenticated:u}=se(),{getContent:g,saveContent:m,isLoading:P}=be(),[C,$]=n.useState(""),[V,D]=n.useState(""),[z,x]=n.useState(!1),[N,I]=n.useState(!1),G=n.useRef(null);n.useEffect(()=>{if(P||!G.current)return;const y=xe(G.current);$(y);const O=g(y,f,e);D(O),x(!0),console.log("[ModernEditableImage] Initialized:",{context:y,contextId:f,defaultSrc:e,savedSrc:O})},[f,e,g,P]);const X=n.useCallback(()=>{u&&C&&I(!0)},[u,C]),E=n.useCallback(async y=>{if(C){try{const O={content:y,context:C,context_id:f,contentType:"text",lastModified:Date.now()};await m(O,e)?(D(y),console.log(`[ModernEditableImage] Image source saved for ${f}`)):console.error(`[ModernEditableImage] Failed to save image source for ${f}`)}catch(O){console.error("[ModernEditableImage] Error saving image:",O)}I(!1)}},[C,f,m,e]);return P||!z?i.jsx("div",{className:`editable-image-skeleton ${o}`,style:{...l,width:c||"100%",height:s||"200px",background:"linear-gradient(90deg, #e5e7eb 25%, #f3f4f6 50%, #e5e7eb 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite",borderRadius:"0.375rem"}}):i.jsxs(i.Fragment,{children:[i.jsx("img",{ref:G,src:V,alt:r,width:c,height:s,loading:b,className:`editable-image-seamless ${u?"is-authenticated":""} ${d?"editable-highlight":""} ${o}`,style:{...l,cursor:u?"pointer":"default",transition:"outline-color 150ms ease",outline:"2px solid transparent",outlineOffset:"1px",...u&&{":hover":{outlineColor:"rgba(59, 130, 246, 0.3)"}},...d&&u&&{outlineColor:"rgba(59, 130, 246, 0.3)",outlineStyle:"dashed"}},onClick:X,title:u?"Click to change image":void 0,"data-context":C,"data-context-id":f,role:u?"button":void 0,tabIndex:u?0:void 0,"aria-label":u?`Edit image: ${r||f}`:r,onKeyDown:u?y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),X())}:void 0}),i.jsx(Fe,{isOpen:N,onClose:()=>I(!1),onImageSelected:E})]})},yt=n.memo(vt),wt=({children:f,backgroundImage:e,id:r,className:o="",style:l={},as:c="div",showEditableHighlights:s=!1})=>{const{isAuthenticated:b}=se(),{getContent:d,saveContent:u,isLoading:g}=be(),[m,P]=n.useState(!1),[C,$]=n.useState(""),[V,D]=n.useState(""),[z,x]=n.useState(""),[N,I]=n.useState(!1),[G,X]=n.useState(!1),[E,y]=n.useState(!1),O=n.useRef(null),v=n.useRef(null),w=n.useCallback(k=>{const B=k.match(/url\(['"]?([^'"]+)['"]?\)/);return B?B[1]:k},[]),j=n.useCallback(k=>!k||k==="none"?"none":`url('${k}')`,[]);n.useEffect(()=>{if(g||!O.current)return;const k=xe(O.current);$(k);const B=w(e),re=d(k,r,B);D(re),X(!0),console.log("[EditableBackground] Initialized:",{context:k,contextId:r,defaultUrl:B,savedUrl:re})},[r,e,d,g,w]);const h=()=>i.jsx("button",{onClick:L,className:"editable-background-edit-btn",style:{position:"absolute",top:"8px",right:"8px",width:"32px",height:"32px",background:"rgba(0, 0, 0, 0.8)",color:"white",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",zIndex:10,transition:"all 0.2s ease",opacity:s?1:0},title:"Modifier l'image de fond",onMouseEnter:k=>{k.currentTarget.style.opacity="1"},onMouseLeave:k=>{k.currentTarget.style.opacity=s?"1":"0"},children:"🖼️"}),L=n.useCallback(()=>{b&&!m&&C&&(P(!0),x(V),y(!1),setTimeout(()=>{var k,B;(k=v.current)==null||k.focus(),(B=v.current)==null||B.select()},0))},[b,m,C,V]),S=n.useCallback(k=>{x(k),y(!1)},[]),H=n.useCallback(async k=>!k||k==="none"?!0:new Promise(B=>{const re=new Image;re.onload=()=>B(!0),re.onerror=()=>B(!1),re.src=k}),[]),M=n.useCallback(async()=>{if(!C||N)return;const k=z.trim()||"none";if(k!=="none"){try{new URL(k,window.location.href)}catch{if(!k.startsWith("/")&&!k.startsWith("./")&&!k.startsWith("../")){alert('URL invalide. Utilisez une URL complète, un chemin relatif valide, ou "none".');return}}if(!await H(k)&&!window.confirm("L'image ne semble pas se charger correctement. Voulez-vous quand même sauvegarder cette URL ?"))return}I(!0);try{const B={content:k,context:C,context_id:r,contentType:"text",lastModified:Date.now()},re=w(e);await u(B,re)?(D(k),P(!1),console.log(`[EditableBackground] Background URL saved for ${r}`)):console.error(`[EditableBackground] Failed to save background URL for ${r}`)}finally{I(!1)}},[C,z,N,r,u,e,w,H]),U=n.useCallback(()=>{x(V),P(!1)},[V]),q=n.useCallback(k=>{k.key==="Escape"?(k.preventDefault(),U()):k.key==="Enter"&&(k.preventDefault(),M())},[U,M]),Z={...l,backgroundImage:j(m?z:V),position:"relative",transition:"all 0.2s ease"};return g||!G?n.createElement(c,{ref:O,className:o,style:{...l,visibility:"hidden"}},f):n.createElement(c,{ref:O,className:`editable-background ${b?"is-authenticated":""} ${s&&b?"editable-highlight":""} ${o}`,style:Z,"data-context":C,"data-context-id":r,onMouseEnter:k=>{if(b&&!m){const B=k.currentTarget.querySelector(".editable-background-edit-btn");B&&(B.style.opacity="1")}},onMouseLeave:k=>{if(b&&!m&&!s){const B=k.currentTarget.querySelector(".editable-background-edit-btn");B&&(B.style.opacity="0")}}},i.jsxs(i.Fragment,{children:[f,b&&!m&&i.jsx(h,{}),m&&b&&i.jsxs("div",{className:"editable-background-editor",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.95)",padding:"16px",borderRadius:"8px",minWidth:"300px",maxWidth:"90%",zIndex:1e3,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"},children:[i.jsx("h4",{style:{margin:"0 0 12px 0",color:"white",fontSize:"16px"},children:"Modifier l'image de fond"}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx("input",{ref:v,type:"text",value:z,onChange:k=>x(k.target.value),onKeyDown:q,placeholder:"URL de l'image ou 'none'",style:{flex:1,padding:"8px 12px",border:"1px solid rgba(255, 255, 255, 0.3)",background:"rgba(255, 255, 255, 0.1)",color:"white",borderRadius:"4px",fontSize:"14px"},disabled:N}),i.jsx("button",{onClick:()=>y(!0),disabled:N,style:{padding:"8px 16px",background:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},title:"Uploader une image",children:"📤"}),i.jsx("button",{onClick:M,disabled:N,style:{padding:"8px 16px",background:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:N?"not-allowed":"pointer",opacity:N?.6:1,fontSize:"14px",fontWeight:"500"},children:N?"Saving...":"Save"}),i.jsx("button",{onClick:U,disabled:N,style:{padding:"8px 16px",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Cancel"})]}),i.jsx("div",{style:{marginTop:"8px",fontSize:"12px",color:"rgba(255, 255, 255, 0.6)"},children:"Exemples : https://example.com/image.jpg, /images/hero.jpg, none"})]}),i.jsx(Fe,{isOpen:E,onClose:()=>y(!1),onImageSelected:S})]}))},Et=n.memo(wt),St=({children:f,id:e,attribute:r,defaultValue:o,validator:l,transformer:c,showEditableHighlights:s=!1,editLabel:b})=>{const{isAuthenticated:d}=se(),{getContent:u,saveContent:g,isLoading:m}=be(),[P,C]=n.useState(!1),[$,V]=n.useState(""),[D,z]=n.useState(""),[x,N]=n.useState(""),[I,G]=n.useState(!1),[X,E]=n.useState(!1),[y,O]=n.useState(""),v=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{if(m||!v.current)return;const U=xe(v.current);V(U);const q=`${e}-${r}`,Z=u(U,q,o);z(Z),E(!0),console.log("[EditableAttribute] Initialized:",{context:U,contextId:q,attribute:r,defaultValue:o,savedValue:Z})},[e,r,o,u,m]);const j=n.useCallback(U=>{U.preventDefault(),U.stopPropagation(),d&&!P&&$&&(C(!0),N(D),O(""),setTimeout(()=>{var q,Z;(q=w.current)==null||q.focus(),(Z=w.current)==null||Z.select()},0))},[d,P,$,D]),h=n.useCallback(U=>{if(!l)return!0;const q=l(U);return typeof q=="string"?(O(q),!1):(O(""),q)},[l]),L=n.useCallback(async()=>{if(!$||I||!h(x))return;const U=c?c(x):x;G(!0);try{const q=`${e}-${r}`,Z={content:U,context:$,context_id:q,contentType:"text",lastModified:Date.now()};await g(Z,o)?(z(U),C(!1),console.log(`[EditableAttribute] Attribute ${r} saved for ${e}`)):console.error(`[EditableAttribute] Failed to save attribute ${r} for ${e}`)}finally{G(!1)}},[$,x,I,e,r,g,o,h,c]),S=n.useCallback(()=>{N(D),C(!1),O("")},[D]),H=n.useCallback(U=>{U.key==="Escape"?(U.preventDefault(),S()):U.key==="Enter"&&(U.preventDefault(),L())},[S,L]);if(m||!X)return n.cloneElement(f,{ref:v});const M=n.cloneElement(f,{ref:v,[r]:D,className:`${f.props.className||""} editable-attribute ${d?"is-authenticated":""} ${s?"editable-highlight":""}`.trim(),"data-context":$,"data-context-id":`${e}-${r}`,"data-editable-attribute":r});return i.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[M,d&&!P&&i.jsxs("span",{className:"editable-attribute-indicator",onClick:j,style:{cursor:"pointer"},children:["✏️ ",b||r]}),P&&d&&i.jsxs("div",{className:"editable-attribute-editor",style:{position:"absolute",top:"100%",left:0,marginTop:"8px",background:"rgba(0, 0, 0, 0.95)",padding:"12px",borderRadius:"6px",minWidth:"250px",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},children:[i.jsx("label",{style:{display:"block",marginBottom:"8px",color:"white",fontSize:"13px",fontWeight:"500"},children:b||`Edit ${r}`}),i.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:y?"8px":0},children:[i.jsx("input",{ref:w,type:"text",value:x,onChange:U=>{N(U.target.value),h(U.target.value)},onKeyDown:H,style:{flex:1,padding:"6px 10px",border:`1px solid ${y?"#ef4444":"rgba(255, 255, 255, 0.3)"}`,background:"rgba(255, 255, 255, 0.1)",color:"white",borderRadius:"4px",fontSize:"13px"},disabled:I}),i.jsx("button",{onClick:L,disabled:I||!!y,style:{padding:"6px 12px",background:y?"#6b7280":"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:I||y?"not-allowed":"pointer",opacity:I||y?.6:1,fontSize:"13px"},children:"✓"}),i.jsx("button",{onClick:S,disabled:I,style:{padding:"6px 12px",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"13px"},children:"✕"})]}),y&&i.jsx("div",{style:{color:"#ef4444",fontSize:"12px",marginTop:"-4px"},children:y})]})]})},kt=n.memo(St),We=({children:f,useModernDesign:e=!0})=>{const[r,o]=n.useState(!1),l=()=>{o(c=>!c)};return n.useEffect(()=>{const c=document.body;return r?c.classList.add("editable-highlight-active"):c.classList.remove("editable-highlight-active"),()=>{c.classList.remove("editable-highlight-active")}},[r]),n.useEffect(()=>{const c=document.body;return e?c.classList.add("inline-editor-modern"):c.classList.remove("inline-editor-modern"),()=>{c.classList.remove("inline-editor-modern")}},[e]),i.jsx(Ne.Provider,{value:{showEditableHighlights:r},children:i.jsx(lt,{children:i.jsx(st,{children:i.jsxs(ut,{children:[f,i.jsx(Le,{showEditableHighlights:r,toggleEditableHighlights:l}),i.jsx(dt,{})]})})})})},Ne=n.createContext({showEditableHighlights:!1}),Ct=()=>n.useContext(Ne).showEditableHighlights;W.EditableAttribute=kt,W.EditableBackground=Et,W.InlineEditor=We,W.ModernEditableImage=yt,W.ModernEditableWrapper=xt,W.ModernEditorToolbar=Le,W.default=We,W.useAuth=se,W.useContent=be,W.useEditableHighlights=Ct,W.useNotifications=he,Object.defineProperties(W,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
